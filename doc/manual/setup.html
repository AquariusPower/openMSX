<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
"http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<link title="Purple" rel="stylesheet" href="manual-purple.css" type="text/css" />
<link title="Minty" rel="alternate stylesheet" href="manual-minty.css" type="text/css" />
<link title="Plain" rel="alternate stylesheet" href="manual.css" type="text/css" />
<title>openMSX Setup Guide</title>
</head>

<body>

<h1>openMSX Setup Guide</h1>

<h2>Contents</h2>
<ol class="toc">
	<li><a class="internal" href="#intro">1. Introduction</a>
		<ol class="toc">
			<li><a class="internal" href="#newver">1.1. New Versions of this Document</a></li>
			<li><a class="internal" href="#purpose">1.2. Purpose</a></li>
			<li><a class="internal" href="#contrib">1.3. Contributors</a></li>
			<li><a class="internal" href="#history">1.4. Revision History</a></li>
		</ol>
	</li>
	<li><a class="internal" href="#machext">2. Machines and Extensions</a></li>
	<li><a class="internal" href="#systemroms">3. System ROMs</a>
		<ol class="toc">
			<li><a class="internal" href="#cbios">3.1. C-BIOS</a></li>
			<li><a class="internal" href="#dumprom">3.2. Dumping ROMs</a></li>
			<li><a class="internal" href="#downloadrom">3.3. Downloading ROMs</a></li>
		</ol>
	</li>
	<li><a class="internal" href="#settings">4. User Preferences</a></li>
	<li><a class="internal" href="#hardwareedit">5. Writing Machine Descriptions</a></li>
	<li><a class="internal" href="#tuning">6. Performance Tuning</a>
		<ol class="toc">
			<li><a class="internal" href="#slow">6.1. If openMSX Runs Slow</a></li>
			<li><a class="internal" href="#linuxrtc">6.2. Timing using the Real Time Clock (Linux)</a></li>
		</ol>
	</li>
	<li><a class="internal" href="#contact">7. Contact Info</a></li>
</ol>

<h2><a id="intro">1. Introduction</a></h2>

<h3><a id="newver">1.1. New Versions of this Document</a></h3>
<p>
The latest version of the openMSX manual can be found on the openMSX home page:
</p>
<p>
<a class="external" href="http://openmsx.sf.net/manual/">http://openmsx.sf.net/manual/</a>
</p>
<p>
You can also use this URL to get up-to-date versions of the hyperlinks
if you printed out this manual.
</p>

<h3><a id="purpose">1.2. Purpose</a></h3>
<p>
This guide is about openMSX, the open source MSX emulator that tries to achieve
near-perfect emulation by using a novel emulation model.
You can find more information about openMSX on the
<a class="external" href="http://openmsx.sf.net/">openMSX home page</a>.
You can also download the emulator itself from there.
</p>

<p>
openMSX is in alpha state, which means that some things work but not all
features are implemented yet.
Many emulation features are implemented, but in terms of user interface
it is rather bare bones.
However, since the emulation is already pretty good,
it would be nice if non-insiders would be able to play with it, too.
For those people, we have written this guide.
It explains how you can get the emulator running on your system,
i.e. how to get the sources and compile them.
</p>

<p>
This guide describes the setup of openMSX.
After installation,
openMSX is ready to run using C-BIOS and the default settings.
In this guide you can read how to configure openMSX
to emulate actual MSX machines (such as Panasonic FS-A1GT).
It also describes how you can have openMSX start up
with your personal settings,
how you can configure openMSX and your system for optimal performance
and several other configuration related topics.
</p>

<p>
<em>Disclaimer:</em>
We do not claim this guide is complete or even correct.
What you do with the information in it is entirely at your own risk.
We just hope it helps you enjoy openMSX more.
</p>

<h3><a id="contrib">1.3. Contributors</a></h3>

<p>
The following people contributed to this document in one way or another:
</p>
<ul>
<li>Jorrith Schaap</li>
<li>Manuel Bilderbeek</li>
<li>Maarten ter Huurne</li>
<li>other openMSX developers</li>
</ul>
<p>
Thanks to all of them!
</p>

<h3><a id="history">1.4. Revision History</a></h3>

<p>
This section gives an overview of the changes that were made to this document.
It doesn't contain every single modification (use the CVS log for that),
only the big picture.
</p>

<dl>

<dt>2003-09-21: Maarten ter Huurne</dt>
<dd>
Split the Setup Guide off from the openMSX HOWTO.
Converted to XHTML.
Restructured the document.
Rewrote some text to fit better in the new structure and format.
</dd>

<dt>2002, 2003: Manuel Bilderbeek &amp; others</dt>
<dd>
Various updates to the HOWTO.
</dd>

<dt>2002: Manuel Bilderbeek &amp; Jorrith Schaap</dt>
<dd>
Original text written as part of the openMSX HOWTO.
</dd>

</dl>

<h2><a id="machext">2. Machines and Extensions</a></h2>

<p>
We use the word <em>machine</em> to refer to a specific
MSX model. For example, the Sony HB-75P is a machine.
openMSX does not have a fixed machine hardcoded into it.
Instead, many different MSX machines can be emulated.
The details of a machine are described in an XML file.
This file describes how much memory a machine has,
what video processor it has, in which slots its system ROMs are located,
whether the machine has a built-in disk drive etc.
openMSX reads the machine description XML and will then emulate exactly
that MSX machine, which can be anything from an MSX1 with 16K of RAM
to the MSX turbo R GT.
</p>

<p>
The openMSX distribution contains XML files describing many existing MSX
models.
You can find them in the <code>share/machines</code> directory.
If you want to run one of those machines,
you also need the system ROMs for that machine.
See the <a class="internal" href="#systemroms">next chapter</a> for more
information on system ROMs.
You can also create your own machine descriptions,
to expand existing MSX models or to create your own fantasy MSX.
More about that in a
<a class="internal" href="#hardwareedit">later chapter</a>.
</p>

<p>
An <em>extension</em> is a piece of MSX hardware that can be
inserted into a cartridge slot to extend the capabilities of an MSX.
Examples of extensions are the Panasonic FM-PAC, the Sunrise IDE interface
and an external 4MB memory mapper.
Extensions, like machines, are described in XML files.
You can find a lot of predefined extensions
in the <code>share/extensions</code> directory.
Some extensions need ROM images in order to run, similar to system ROMs.
</p>

<h2><a id="systemroms">3. System ROMs</a></h2>

<p>
An MSX machine consists of a lot of hardware, but also contains some software.
Such software includes the BIOS, MSX-BASIC, software controlling disk drives
and built-in applications (firmware).
openMSX emulates the MSX hardware, but it needs MSX system software to emulate
a full MSX system.
Because the internal software is located in ROM chips, it is referred to as
<em>system ROMs</em>.
</p>

<p>
The software in the system ROMs, like most software, is copyrighted.
Depending on your local laws, there are certain things you are allowed to
do with copyrighted software and certain things you are not allowed to do.
In this manual, a couple of options are listed for providing system ROMs
to your openMSX installation.
It is up to you, the user, to select an option that is legal in your country.
</p>

<h3><a id="cbios">3.1. C-BIOS</a></h3>

<p>
C-BIOS stands for "Compatible BIOS".
It tries to be compatible with the MSX BIOS found in real MSX machines,
but it was written from scratch, so all copyrights belong to its authors.
BouKiChi, the original author of C-BIOS, was kind enough to allow C-BIOS
to be distributed together with openMSX.
Since then, Reikan took over maintenance of C-BIOS and the license
was changed to give users and developers even more freedom in using C-BIOS.
Every now and then, an updated version of C-BIOS is released.
You can wait for it to be included in the next openMSX release,
or download it directly from the
<a class="external" href="http://www.ranpub.com/CBIOS/">C-BIOS home page</a>.
</p>

<p>
C-BIOS can be used to run most MSX1 and MSX2 cartridge-based games.
It does not include MSX-BASIC and does not support disk drives,
so programs depending on that will not run.
openMSX contains two machine configurations using C-BIOS.
The machine <code>cbios-msx1</code> is an MSX1 with 64K RAM.
The machine <code>cbios-msx2</code> is an MSX2 with 512K RAM and 128K VRAM.
The latter is the default machine for openMSX after installation,
so if you change nothing to the openMSX configuration,
then <code>cbios-msx2</code> is the machine that will be booted.
</p>

<p>
It is always legal for you to run the C-BIOS ROMs in openMSX.
You are allowed to use C-BIOS and its source code in various other ways
as well, read the C-BIOS license for details.
It is located in the files <code>cbios.txt</code> (Japanese) and
<code>cbios.en.txt</code> (English).
</p>

<h3><a id="dumprom">3.2. Dumping ROMs</a></h3>

<p>
If you own a real MSX machine, you can dump the contents of its system ROMs
to create ROM images you can run in openMSX.
This way, you can emulate the MSX machines you are familiar with.
</p>

<p>
The easiest way to dump system ROMs is to run special dumping tool on your
real MSX, which copies the contents of the system ROMs to disk.
Sean Young has made such tools, you can find the
<a class="external" href="http://www.msxnet.org/utils/saverom">tools and documentation</a>
on his web site.
These tools can also be used to dump cartridge ROMs, which may be useful later,
if you want to use certain extensions or play games.
</p>

<p>
When the ROMs are dumped, you have a disk with a number of ROM images.
Copy these images to the subdirectory called <code>roms</code> in the
machine directory.
For example, if you dumped the ROMs of a Philips NMS 8250 machine,
copy them to <code>share/machines/Philips_NMS_8250/roms</code>.
Look in the file hardwareconfig.xml for the file names openMSX expects
the ROM images to have.
</p>

<p>
The machine configurations bundled with openMSX often refer to ROM files
that span multiple 16K pages.
For example, in the NMS 8250 configuration, the BIOS and MSX-BASIC are
expected in a single 32K ROM image.
If you created two 16K images when dumping, you can concatenate them
using tools included with your OS.
In Linux and other Unix(-like) systems you can do it like this:
</p>
<div class="commandline">
cat bios.rom basic.rom &gt; nms8250_basic-bios2.rom
</div>
<p>
In Windows, open a command prompt and issue this command:
</p>
<div class="commandline">
copy /b bios.rom + basic.rom nms8250_basic-bios2.rom
</div>

<p>
You can check whether you have the same images as the machine configuration
was tested with using the <code>SHA1SUMS</code> file.
This file contains checksums of ROM images that are known to work.
You can compare the checksums of your ROM images to this file with the
<code>sha1sum</code> tool.
It is installed by default on most Linux systems,
on Windows you would have to download it separately.
If the checksums match, it is almost certain you have correct system ROMs.
If the checksums do not match, it could mean something went wrong
dumping the ROMs, or it could mean you have a slightly older/newer model
which contains different system ROMs.
</p>

<p>
Using ROMs dumped from machines you own is generally considered
a proper thing to do in the MSX community.
When the MSX machine was bought in a shop years ago, you or the person that
originally bought it paid money for the MSX machine.
A small part of that money paid for the software in the system ROMs.
However, we are no legal experts, so it is up to you to check whether it
is legal in your country to use dumped ROMs of machines you own.
</p>

<h3><a id="downloadrom">3.3. Downloading ROMs</a></h3>

<p>
Some WWW and FTP sites offer MSX system ROMs as a download.
Some MSX emulators include system ROMs in their distribution.
Downloaded system ROMs can be used in the same way as
system ROMs you dumped yourself.
</p>

<p>
It may be illegal in your country to download system ROMs.
Please inform yourself of the legal aspects before considering this option.
Whatever you decide, is your own responsibility.
</p>

<h2><a id="settings">4. User Preferences</a></h2>

<p>
In the file <code>share/settings.xml</code> you can specify
your user preferences.
These will be loaded every time openMSX starts.
Note for Linux users: it is convenient to use the file
<code>~/.openMSX/share/settings.xml</code> to store your custom settings,
instead of editing <code>settings.xml</code> in the openMSX installation
directory.
</p>

<p>
One of the preferences is the default machine:
the machine openMSX uses if you did not specify one on the command line.
</p>

<p>
The default <code>settings.xml</code> also contains a UserDirectories section.
In this
section you can specify directories in which openMSX should look for to find
files that you mention on the command line or in the Console (see below). If
you have some big directory with a lot of disk images, e.g., you can add a line
with that path to this section, so that you don't have to specify the whole
path anymore.
Use this to make things just a little more comfortable.
</p>

<p>
You can also register more file extensions in the <code>settings.xml</code> file.
See the "FileTypes" section of the file.
</p>

<p>
A special section is <code>AutoCommands</code>.
Here you can list console commands that will be executed
when openMSX starts up.
By using the <code>set</code> command you can modify the runtime settings
of openMSX.
By using the <code>bind</code> command you can create custom key bindings.
</p>

<p>
There are more settings you can make using this file. Just look at the file
after you have a little more experience with openMSX and the comments in it
will tell you what everything means.
</p>

<h2><a id="hardwareedit">5. Writing Machine Descriptions</a></h2>

<p>
There are two ways to use extra devices in your emulated MSX:
you can use an extension
(which is analogous to inserting a cartridge with the device into the MSX)
or you can modify the hardware configuration file
(which is analogous to open the MSX and build in the device).
As in the real world, extensions are easier to use,
but modifying the machine gives you more possibilities.
Using extensions is covered in the
<a class="external" href="user.html">User's Manual</a>;
this chapter tells you how you can create or modify machine descriptions.
By editing the XML files, you can for example increase the amount of RAM,
add a built-in MSX-MUSIC, add a disk drive, create extra cartridge slots etc.
</p>

<p>
You can modify an MSX machine (e.g. to add devices) by editing the XML config
file. So, let's make a copy of <code>machines/Philips_NMS_8250/hardwareconfig.xml</code> and
put it in <code>machines/mymsx/</code> under the name of <code>hardwareconfig.xml</code>.
It's the config we are going to play with; our custom MSX.
Note for Linux users: it is convenient to use the directory
<code>~/.openMSX/share/machines</code> to store your home-made machines,
instead of the openMSX installation directory.
</p>

<p>
There is a special config file in the source tree that isn't usable by itself,
but contains XML fragments of some possible devices currently implemented in
openMSX. This file is called <code>exampleconfigs.xml</code> and is currently located in
the directory <code>doc/</code>. It is very convenient to copy and paste
parts of it to your own <code>mymsx/hardwareconfig.xml</code>. Of course, you can also use
fragments from other existing configurations that can be found in
<code>share/machines</code> or <code>share/extensions</code>.
</p>

<p>
To add an FM PAC to the 8250, just copy this part from the <code>exampleconfigs.xml</code> to
some place in your <code>mymsx/hardwareconfig.xml</code> file (between the <code>&lt;msxconfig&gt;</code> and
<code>&lt;/msxconfig&gt;</code> tags!):
</p>

<pre>
  &lt;device id="FM PAC"&gt;
    &lt;type&gt;FM-PAC&lt;/type&gt;
    &lt;slotted&gt; &lt;ps&gt;2&lt;/ps&gt; &lt;ss&gt;0&lt;/ss&gt; &lt;page&gt;1&lt;/page&gt; &lt;/slotted&gt;
    &lt;parameter name="filename"&gt;roms/fmpac.rom&lt;/parameter&gt;
    &lt;parameter name="volume"&gt;9000&lt;/parameter&gt;
    &lt;parameter name="mode"&gt;left&lt;/parameter&gt;
    &lt;parameter name="sramname"&gt;fmpac.pac&lt;/parameter&gt;
  &lt;/device&gt;
</pre>

<p>
Don't forget to add the <code>fmpac.rom</code> file to the roms directory of your machine.
</p>

<p>
You can make some settings, too. The number in the <code>&lt;ps&gt;</code> tag indicates the
primary slot of the MSX you're going to emulate. In this case the second
cartridge slot of the NMS-8250 is used. <code>&lt;ss&gt;</code> means sub slot. Our NMS-8250
doesn't have an expanded slot in slot 2, so we have to specify 0 here. (The
MotherBoard config part at the top of the config file says what slots are
expanded; a normal 8250 has slot 3 expanded.)
The parameter filename can be adjusted to the name of your (64kB!) FM-PAC ROM
file (note: if the file is not 64kB (65536 bytes) in size, it won't work).
"mode" says to what channel the FM-PAC's sound will be routed.
"sramname" specifies the file name for file in which the SRAM contents will be
saved to or loaded from. The saved files are compatible with the files that are
saved by the (real) FM-PAC commander's save option.
</p>

<p>
After saving your config and running openMSX again, you should be able to get
the FM PAC commander with <code>CALL FMPAC</code> in the emulated MSX!
</p>

<p>
In a similar fashion, you can also add an MSX-Audio device (<code>&lt;device
id="MSX-Audio"&gt;</code>, note that some programs also need the MSX-Audio-Midi device to
detect the Music Module; this device is at the moment not fully implemented
though), an empty SCC cartridge (<code>&lt;device id="Empty SCC Cartridge"&gt;</code>), etc. Just
browse the <code>exampleconfigs.xml</code> file or the extensions and see what you can find.
Remember that you can not put two devices in the same (sub)slot! You may need to
add a slot expander, by simply setting a slot's subslotted parameter to "true"
in the MotherBoard config tag at the top of the file. On the other hand, not all
devices need a slot. An example is the MSX-Audio device.
</p>

<p>
Another thing you may want to change: the amount of RAM of the MSX: change the
"size" parameter in the "Main RAM" device config.
</p>

<p>
If you understand the basics of XML, you should be able to compose your MSX now!
You can use the ready-made configurations in <code>share/machines</code> as
examples.
</p>

<h2><a id="tuning">6. Performance Tuning</a></h2>

<p>
This chapter contains some tips for tuning the performance of openMSX
on your system.
</p>

<h3><a id="slow">6.1. If openMSX Runs Slow</a></h3>

<p>
CPU and graphics performance varies a lot, depending on the openMSX
settings and the MSX hardware and software you're emulating.
Some things run fine on a 200MHz machine, others are slow on a 2GHz
machine.
</p>

<p>
If openMSX runs slow, you can try the following measures:
</p>
<ul>
<li>
Make sure there are no CPU or I/O heavy background processes is running.
Downloads, distributed calculation efforts, search indexers etc may grab
the CPU from time to time, leaving less time for openMSX to do its job.
Even if they only do so only once in a while, it may be enough to cause
emulation to stutter.
</li>
<li>
The SDLGL renderer needs hardware acceleration to run at a decent speed.
If your OpenGL driver is not hardware accelerated,
use the SDLHi renderer instead.
If you have hardware accelerated OpenGL, but an older graphics card,
try disabling scanlines and blur (set them to 0).
</li>
<li>
Use 16-bit colour mode instead of 32-bit.
openMSX uses your platform's default setting.
</li>
<li>
Use line accuracy (default) instead of pixel accuracy.
Pixel accuracy takes a lot of overhead, while it is only really needed
for a couple of demos (Unknown Reality, Verti).
</li>
<li>
Turn on frame skip ("set frameskip auto").
</li>
<li>
Use the low-res SDLLo renderer (75% less pixels to fill).
</li>
<li>
Use a lower sound mixing frequency, for example 22050Hz instead of 44100Hz.
</li>
<li>
Use less sound channels, for example use MSX-MUSIC (maximum 9 channels)
instead of MoonSound (maximum 18+24 channels).
</li>
</ul>

<h3><a id="linuxrtc">6.2. Timing using the Real Time Clock (Linux)</a></h3>

<p>
If you find the openMSX timing bad (i.e. too irregular),
you may want to enable RealTimeClock (RTC) based timing.
This feature is only available in the Linux version of openMSX.
</p>

<p>
Most Linux systems need some configuration before the RTC is usable.
You will have to have read permission to the device <code>/dev/rtc</code>
on your system
(which maybe a symlink to <code>/dev/misc/rtc</code> or something else).
You should also have RTC support in your kernel or loaded as a kernel module.
After arranging this, you will also need to type the following as root:
</p>
<div class="commandline">
echo 1024 &gt; /proc/sys/dev/rtc/max-user-freq
</div>
<p>
or add it to your system startup scripts.
This line gives user processes, such as openMSX, permission to configure
the RTC to generate interrupts at frequencies up to 1024Hz.
</p>

<p>
openMSX will try to use RTC timing by default, but if that fails,
it prints a warning and falls back to the less accurate SDL timing.
</p>

<h2><a id="contact">7. Contact Info</a></h2>

<p>
Since openMSX is still in heavy development, feedback and bug reports are very
welcome!
</p>

<p>
If you encounter problems, you have several options:
</p>

<ol>
<li>
If you're a regular user and want to discuss openMSX and possible problems,
join our <code>openmsx-user</code> mailing list.
More info on the
<a class="external" href="http://sourceforge.net/mail/?group_id=38274">openMSX mailing lists</a>,
including an archive of old messages, can be found at SourceForge.
</li>
<li>
Go to our IRC channel: <code>#openMSX</code> on <code>irc.freenode.net</code>
and ask your question there.
</li>
<li>
If you want to address the openMSX developers directly,
post a message to the <code>openmsx-devel</code> mailing list.
More info on the
<a class="external" href="http://sourceforge.net/mail/?group_id=38274">openMSX mailing lists</a>,
including an archive of old messages, can be found at SourceForge.
</li>
<li>
Use one of the
<a class="external" href="http://sourceforge.net/tracker/?group_id=38274">openMSX trackers</a>
at SourceForge.
At the moment of writing, there are four trackers:
Bugs, Support Requests, Patches and Feature Requests.
</li>
</ol>

<p>
For experienced users: if you get a crash,
try to provide a <code>gdb</code> backtrace.
This will only work if you did not strip the openMSX binary
of its debug symbols.
</p>

<p>
In any case, try to give as much information as possible when you describe your
bug or request.
</p>

<p class="version">
$Id$
</p>

</body>
</html>
