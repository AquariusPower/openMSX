<?xml version="1.0" encoding="iso-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
"http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<link title="Purple" rel="stylesheet" href="manual-purple.css" type="text/css" />
<link title="Minty" rel="alternate stylesheet" href="manual-minty.css" type="text/css" />
<link title="Plain" rel="alternate stylesheet" href="manual.css" type="text/css" />
<title>openMSX Setup Guide</title>
</head>

<body>

<h1>openMSX Setup Guide</h1>

<h2>Contents</h2>
<ol class="toc">
	<li><a class="internal" href="#intro">1. Introduction</a>
		<ol class="toc">
			<li><a class="internal" href="#newver">1.1. New Versions of this Document</a></li>
			<li><a class="internal" href="#purpose">1.2. Purpose</a></li>
			<li><a class="internal" href="#contrib">1.3. Contributors</a></li>
			<li><a class="internal" href="#history">1.4. Revision History</a></li>
		</ol>
	</li>
	<li><a class="internal" href="#next">5. Next Steps</a></li>
	<li><a class="internal" href="#contact">6. Contact Info</a></li>
</ol>

<h2><a id="intro">1. Introduction</a></h2>

<h3><a id="newver">1.1. New Versions of this Document</a></h3>
<p>
The latest version of the openMSX manual can be found on the openMSX home page:
</p>
<p>
<a class="external" href="http://openmsx.sf.net/manual/">http://openmsx.sf.net/manual/</a>
</p>
<p>
You can also use this URL to get up-to-date versions of the hyperlinks
if you printed out this manual.
</p>

<h3><a id="purpose">1.2. Purpose</a></h3>
<p>
This guide is about openMSX, the open source MSX emulator that tries to achieve
near-perfect emulation by using a novel emulation model.
You can find more information about openMSX on the
<a class="external" href="http://openmsx.sf.net/">openMSX home page</a>.
You can also download the emulator itself from there.
</p>

<p>
openMSX is in alpha state, which means that some things work but not all
features are implemented yet.
Many emulation features are implemented, but in terms of user interface
it is rather bare bones.
However, since the emulation is already pretty good,
it would be nice if non-insiders would be able to play with it, too.
For those people, we have written this guide.
It explains how you can get the emulator running on your system,
i.e. how to get the sources and compile them.
</p>

<p>
This guide describes the setup of openMSX.
After installation,
openMSX is ready to run using C-BIOS and the default settings.
In this guide you can read how to configure openMSX
to emulate actual MSX machines (such as Panasonic FS-A1GT).
It also describes how you can have openMSX start up
with your personal settings,
how you can configure openMSX and your system for optimal performance
and several other configuration related topics.
</p>

<p>
<em>Disclaimer:</em>
We do not claim this guide is complete or even correct.
What you do with the information in it is entirely at your own risk.
We just hope it helps you enjoy openMSX more.
</p>

<h3><a id="contrib">1.3. Contributors</a></h3>

<p>
The following people contributed to this document in one way or another:
</p>
<ul>
<li>Jorrith Schaap</li>
<li>Manuel Bilderbeek</li>
<li>Maarten ter Huurne</li>
<li>other openMSX developers</li>
</ul>
<p>
Thanks to all of them!
</p>

<h3><a id="history">1.4. Revision History</a></h3>

<p>
This section gives an overview of the changes that were made to this document.
It doesn't contain every single modification (use the CVS log for that),
only the big picture.
</p>

<dl>

<dt>2003-09-21: Maarten ter Huurne</dt>
<dd>
Split the Setup Guide off from the openMSX HOWTO.
Converted to XHTML.
Restructured the document.
Rewrote some text to fit better in the new structure and format.
</dd>

<dt>2002, 2003: Manuel Bilderbeek &amp; others</dt>
<dd>
Various updates to the HOWTO.
</dd>

<dt>2002: Manuel Bilderbeek &amp; Jorrith Schaap</dt>
<dd>
Original text written as part of the openMSX HOWTO.
</dd>

</dl>

<pre>
3. Preparing the emulator for a first test
   ---------------------------------------

Two options here. You can either try to run a real MSX, but for that you need
the ROMs for that MSX. They are not supplied with openMSX. An alternative is
using C-BIOS: an MSX compatible BIOS made by BouKiChi, which can be used to run
most ROM games with openMSX. For a first test, you don't need to do anything to
use C-BIOS. Otherwise, here are the instructions for using a simple machine. If
you want to use C-BIOS, you can skip the rest of this section. But you may want
to read it later, because it contains some valuable hints.

First, get the needed ROMs for the emulator. You need the following ROMs:

- an MSX2 BIOS/BASIC ROM (other emulators may call this MSX2.ROM, it contains
  the BIOS and BASIC, see below)
- a disk ROM (often called DISK.ROM)
- the sub-ROM (often called MSX2EXT.ROM)
- and, optional, the 64kB FMPAC.ROM, if you would like to use the FM PAC.

Suppose you have the following files:
msx2.zip (rename the extracted file to nms8250_basic-bios2.rom)
msx2ext.zip (rename extracted file to nms8250-sub.rom)
disk.zip (rename the extracted file to nms8250-disk.rom - this rom
image may be patched though, I'm not sure if it works)
fmpac.zip

Now that you have all ROMs, you can place them into the
share/machines/Philips_NMS_8250/roms directory for now. You noticed I let you
rename the ROMs. This is because one of the configuration files (which configs
openMSX to emulate a Philips NMS 8250), included in the openMSX distribution,
assumes those names for the ROM files. In other words: we are going to emulate
a Philips NMS 8250.

You can also get the ROMs from your real MSX of course. I'm not going to
explain how to do that in this HOWTO though. It will at least guarantee you
that you have exactly the right ROMs.

Later, you may want to emulate the real 8250 (i.e., using the real ROMs of the
8250) or another specific MSX. openMSX provides a lot premade configuration
files for that, but we can not distribute the ROM files for them.  You need to
dump them from your own machine or find another way to get them.

4. Starting the emulator for the first time
   ----------------------------------------

Now we can try starting the emulator for the first time!
Go to your src directory (e.g. openMSX/src).

If you didn't get ROMs, you can use C-BIOS.
Give the following command:

./openmsx -setting ../share/settings.xml ../share/machines/cbios-msx2/hardware.xml

Or, if you did get the ROMs as mentioned in section 3, give the following
command:

./openmsx -setting ../share/settings.xml ../share/machines/Philips_NMS_8250/hardware.xml

Now the emulator should work, i.e. you will see the opening screen of C-BIOS or
the MSX boot logo scrolling up when you got ROMs, all in a window. What did we
just do, actually? We started openMSX and told it that it should use the
settings defined in the file settings.xml (which is in the directory share/) and
that it should emulate a fantasy MSX machine with the C-BIOS (or a Philips
NMS-8250), whose hardware is described in the file cbios-msx2/hardwareconfig.xml
(or Philips_NMS_8250/hardwareconfig.xml), in share/machines/. This is basically
how one uses openMSX. We'll make it easier below.

If you want to use real MSX ROMs, go back to step 3.


5.2 Setting up the .openMSX directory (optional)

This section discusses setting up a ".openMSX" configuration
directory in your home directory. This is not strictly necessary, but it allows
you to customise the openMSX settings and add new MSX machines and hardware
extensions to run in openMSX. Manuel Bilderbeek will tell you how he did it.

I created a directory with the name .openMSX in my home dir. There, I created
the subdirectory share/. This is one of the directories that openMSX looks in,
to find the (default) settings.xml (see 5.3) and romdb.xml (a ROM database to
identify ROM mapper types).
So, .openMSX/ contains settings and other user specific openMSX files. It also
contains the machine configurations, in the subdirectory share/machines/. The
name of this subdirectory is important: openMSX searches here for those machine
configurations. In this share/machines/ directory, all machines have their own
subdirectory. I created my personal MSX configuration (see below) in the
directory mymsx/ under /share/machines/.
Note that hardware configurations should have the name 'hardwareconfig.xml' in
these machine directories. Also the ROM files needed for those machines should
be put in their own directories.
In my case, this share/machines/ directory is just a symlink to the
share/machines directory of the openMSX CVS tree. Of course, for the machines
to work, they need to have the ROM files specified in the hardwareconfig.xml
files.

In ~/.openMSX also some decorations like ConsoleBackgrounds (in the
subdirectory share/skins, see below) and other related files should be stored.
You need settings.xml also here (in share/), unless you want to specify it
manually on the command line with the -setting option, as we have done above.
In settings.xml you can also specify what machine should be used by default.
Edit the file and you will see how to do that. Also, in a subdirectory share/,
romdb.xml should be put. Personally, I used a symbolic link to my CVS source
tree version.

Furthermore, I created a subdirectory extensions/ in ~/.openMSX/share, which is
also a symbolic link to share/extensions in my CVS tree. This is one of
the directories openMSX searches in when you use the -ext command line option.

With this option you can specify an `extension', which is in most cases an
external cartridge with some special hardware in it (e.g., a Panasonic FS-CA1
MSX Audio cartridge, an IDE interface, an FM-PAC, or an MSX-DOS2 cartridge). It
works similarly to the share/machines/ directory and the -machine command. At
the moment, you can just put an XML file with the hardware description of that
cartridge in its own subdirectory in this directory. If you have an XML file
that describes an MSX-DOS 2 cartridge, e.g., you can create a subdirectory
msxdos2 here, in which you put the file hardwareconfig.xml (which is that
description of the MSX DOS 2 cartridge) and the ROM file. Then you can use `-ext
msxdos2' on the command line to use it.  So, the ROM files that are needed for
the extensions have to be in their subdirectories also, if there is no path
given in the hardware description XML file. We prefer to put the ROM files in
their own subdir 'roms' though, to separate them from other files that could be
put in such an extension directory.

/home/manuel/.openMSX:
drwx------    4 manuel   manuel       4096 Feb 17 22:00 persistent/
drwx------    2 manuel   manuel       4096 Mar 29 14:28 share/


/home/manuel/openMSX/share:
lrwxrwxrwx    1 manuel   manuel         50 Mar 29 13:14 extensions -&gt; /home/manuel/cvs/openmsx/openMSX/share/extensions//
lrwxrwxrwx    1 manuel   manuel         48 Mar 29 12:15 machines -&gt;
/home/manuel/cvs/openmsx/openMSX/share/machines//
lrwxrwxrwx    1 manuel   manuel         46 Feb 26 22:41 romdb.xml -&gt; /home/manuel/cvs/openmsx/openMSX/src/romdb.xml
-rw-------    1 manuel   manuel       2391 Feb 18 20:46 settings.xml
lrwxrwxrwx    1 manuel   manuel         45 Mar 29 14:28 skins -&gt; /home/manuel/cvs/openmsx/openMSX/share/skins//

/home/manuel/.openMSX/share/skins:
-rw-------    1 manuel   manuel      21203 Mar 24 23:27 ConsoleBackground.png
-rw-------    1 manuel   manuel       6016 Mar 24 23:27 ConsoleBackground1.png
-rw-------    1 manuel   manuel      13101 Mar 24 23:27 ConsoleBackground2.png
-rw-------    1 manuel   manuel       3348 Mar 24 23:27 ConsoleBackground3.png
-rw-------    1 manuel   manuel       5136 Mar 24 23:27 ConsoleBackground4.png
-rw-------    1 manuel   manuel       6602 Mar 24 23:27 ConsoleBackground5.png
-rw-------    1 manuel   manuel       1471 Mar 24 23:27 ConsoleFont.png
-rw-------    1 manuel   manuel       1402 Mar 24 23:27 ConsoleFont1.png

/home/manuel/.openMSX/share/machines:
drwx------    3 manuel   manuel       4096 Mar 28 23:59 National_CF-1200/
drwx------    3 manuel   manuel       4096 Mar 29 12:32 National_CF-2000/
drwx------    3 manuel   manuel       4096 Mar 28 23:59 National_CF-2700/
[snip!]
drwx------    3 manuel   manuel       4096 Mar 29 12:18 Sanyo_PHC-70FD2/
drwx------    3 manuel   manuel       4096 Mar 29 12:23 cbios-msx1/
drwx------    3 manuel   manuel       4096 Mar 29 12:23 cbios-msx2/
drwx------    2 manuel   manuel       4096 Feb 19 22:29 mymsx/

/home/manuel/.openMSX/share/extensions:
drwx------    4 manuel   manuel       4096 Mar 29 13:37 Panasonic_FS-CA1/
drwx------    3 manuel   manuel       4096 Mar 25 20:52 audio/
drwx------    4 manuel   manuel       4096 Mar 29 13:33 fmpac/
drwx------    4 manuel   manuel       4096 Mar 29 13:16 ide/
drwx------    4 manuel   manuel       4096 Mar 29 14:12 msxdos2/
drwx------    3 manuel   manuel       4096 Mar 25 20:52 scc/
drwx------    3 manuel   manuel       4096 Mar 25 20:52 scc+/

/home/manuel/.openMSX/share/extensions/fs-ca1:
-rw-------    1 manuel   manuel        517 Feb 23 16:00 hardwareconfig.xml
drwx------    2 manuel   manuel       4096 Mar 29 13:37 roms/

/home/manuel/.openMSX/share/extensions/fs-ca1/roms:
-r--------    1 manuel   manuel     131072 Mar 29 13:17 fs-ca1.rom

/home/manuel/.openMSX/share/extensions/ide:
-rw-------    1 manuel   manuel        668 Dec 18 21:21 hardwareconfig.xml
-rw-------    1 manuel   manuel   107373568 Nov 10 23:01 hd.dsk
drwx------    2 manuel   manuel       4096 Mar 29 13:16 roms/

/home/manuel/.openMSX/share/extensions/ide/roms:
-rw-------    1 manuel   manuel     131072 Nov  3 01:35 IDE210.ROM

The directory persistent is automatically created when you close openMSX. There,
persistent states of your MSX machines will be saved: the Real Time Clock
settings, SRAM contents, etc.

Note that the config syntax is still subject to changes, so XML files from one
release may not be compatible with those of other releases. If you want to be
really safe, keep a separate binary + configs per release/CVS date.

If you want to emulate another machine that the one you specified as default
machine, use the -machine command line option. Example:
openmsx -machine mymsx
will start openMSX with the configuration specified in
~/.openMSX/share/machines/mymsx/hardwareconfig.xml.

Make sure that starting openMSX by just typing 'openmsx' in your shell works
now, with your default machine configuration. For now, I'm assuming that you are
emulating the Philips NMS 8250.

5.3 The settings.xml file

As as I said above, I'm using a manually configured MSX machine, that is
described in ~/.openMSX/share/machines/mymsx/hardwareconfig.xml. So, I
configured in settings.xml that mymsx is the default machine to emulate.

The default settings.xml also contains a UserDirectories section. In this
section you can specify directories in which openMSX should look for to find
files that you mention on the command line or in the Console (see below). If
you have some big directory with a lot of disk images, e.g., you can add a line
with that path to this section, so that you don't have to specify the whole
path anymore.
Use this to make things just a little more comfortable.

You can also register more file extensions in the settings.xml file. See the
"FileTypes" section of the file.

There are more settings you can make using this file. Just look at the file
after you have a little more experience with openMSX and the comments in it
will tell you what everything means.


This concludes this section.

7. Adding MSX devices to your (custom) config file
   -----------------------------------------------

OK, a standard NMS-8250 is a bit dull. Let's add some devices.

There are two ways to use extra devices in your emulated MSX. You can use an
extension (which is analogous to inserting a cartridge with the device into the
MSX) or you can modify the hardware configuration file (which is analogous to
open the MSX and build in the device). As it is in the real world, the former is
the easiest thing and the latter the more complicated thing. So, let's start
with the former.

7.2 Modifying the internals of the MSX

Now, let's talk about modifying the internals of your emulated MSX... This is a
bit more advanced, you may skip the rest of this section and read it later, it
won't spoil the fun.

You can modify an MSX machine (e.g. to add devices) by editing the XML config
file. So, let's make a copy of machines/Philips_NMS_8250/hardwareconfig.xml and
put it in ~/.openMSX/share/machines/mymsx/ under the name of hardwareconfig.xml.
It's the config we are going to play with; our custom MSX.

There is a special config file in the source tree that isn't usable by itself,
but contains XML fragments of some possible devices currently implemented in
openMSX. This file is called "exampleconfigs.xml" and is currently located in
the same directory as this file, doc/. It is very convenient to copy and paste
parts of it to your own mymsx/hardwareconfig.xml. Of course, you can also use
fragments from other existing configurations that can be found in
share/machines or share/extensions.

To add an FM PAC to the 8250, just copy this part from the exampleconfigs.xml to
some place in your mymsx/hardwareconfig.xml file (between the &lt;msxconfig&gt; and
&lt;/msxconfig&gt; tags!):

  &lt;device id="FM PAC"&gt;
    &lt;type&gt;FM-PAC&lt;/type&gt;
    &lt;slotted&gt; &lt;ps&gt;2&lt;/ps&gt; &lt;ss&gt;0&lt;/ss&gt; &lt;page&gt;1&lt;/page&gt; &lt;/slotted&gt;
    &lt;parameter name="filename"&gt;roms/fmpac.rom&lt;/parameter&gt;
    &lt;parameter name="volume"&gt;9000&lt;/parameter&gt;
    &lt;parameter name="mode"&gt;left&lt;/parameter&gt;
    &lt;parameter name="sramname"&gt;fmpac.pac&lt;/parameter&gt;
  &lt;/device&gt;

Don't forget to add the fmpac.rom file to the roms direcory of your machine.

You can make some settings, too. The number in the &lt;ps&gt; tag indicates the
primary slot of the MSX you're going to emulate. In this case the second
cartridge slot of the NMS-8250 is used. &lt;ss&gt; means sub slot. Our NMS-8250
doesn't have an expanded slot in slot 2, so we have to specify 0 here. (The
MotherBoard config part at the top of the config file says what slots are
expanded; a normal 8250 has slot 3 expanded.)
The parameter filename can be adjusted to the name of your (64kB!) FM-PAC ROM
file (note: if the file is not 64kB (65536 bytes) in size, it won't work).
"mode" says to what channel the FM-PAC's sound will be routed.
"sramname" specifies the file name for file in which the SRAM contents will be
saved to or loaded from. The saved files are compatible with the files that are
saved by the (real) FM-PAC commander's save option.

After saving your config and running openMSX again, you should be able to get
the FM PAC commander with CALL FMPAC in the emulated MSX!

In a similar fashion, you can also add an MSX-Audio device (&lt;device
id="MSX-Audio"&gt;, note that some programs also need the MSX-Audio-Midi device to
detect the Music Module; this device is at the moment not fully implemented
though), an empty SCC cartridge (&lt;device id="Empty SCC Cartridge"&gt;), etc. Just
browse the exampleconfigs.xml file or the extensions and see what you can find.
Remember that you can not put two devices in the same (sub)slot! You may need to
add a slot expander, by simply setting a slot's subslotted parameter to "true"
in the MotherBoard config tag at the top of the file. On the other hand, not all
devices need a slot. An example is the MSX-Audio device.

Another thing you may want to change: the amount of RAM of the MSX: change the
"size" parameter in the "Main RAM" device config.

If you understand the basics of XML, you should be able to compose most of your MSX now!


9. Reporting bugs and giving feedback
   ----------------------------------

Since openMSX is still in heavy development, feedback and bug reports are very
welcome!

If you encounter problems, you have several options:

1) if you're a regular user and want to discuss openMSX and possible problems,
   join our mailing list openmsx-user@lists.sourceforge.net, see openmsx.sf.net
   -&gt; Project Summary -&gt; Lists
2) go to our IRC channel: #openMSX on irc.freenode.net and ask
3) send an e-mail to the openMSX developer's mailing list:
   openmsx-devel@lists.sourceforge.net. See the project page on SourceForge.
4) go visit the SourceForge page of openMSX:
   http://sourceforge.net/projects/openmsx/
   Then click on "Tracker". This will show you four trackers (at the moment).
   Use the bug tracker to look for bugs and post new ones. You can use the
   Support Request tracker to submit support requests. Feature requests can be
   submitted in the Feature Requests tracker.

For experienced users: if you get a crash, try to provide a gdb backtrace
(don't use strip on the openMSX executable then!).

In any case, try to give as much information as possible when you describe your
bug or request.

10. Some notes
    ----------

10.2 C-BIOS

As already mentioned, there is an alternative for the copyrighted MSX ROMs: you
can also use the C-BIOS, a home made MSX compatible BIOS, by BouKiChi.  There
are config files for it in the share/machines directory. With this BIOS you can
only run an increasing number of ROM files. The files needed for the C-BIOS
itself are in the Contrib/cbios directory. However, you can also just use the
machine "cbios-msx1" or "cbios-msx2" to use C-BIOS.

10.5 Timing using the Real Time Clock (Linux)

If you find the openMSX timing bad (i.e. too irregular), you may want to enable
RealTimeClock (RTC) based timing. Most systems don't let you use this though.
You will have to have read permission to /dev/rtc on your system (which maybe a
symlink to /dev/misc/rtc or something else). After arranging this, you will
also need to type the following as root:
 echo 1024 &gt; /proc/sys/dev/rtc/max-user-freq
or add it to your system startup scripts.

openMSX will try to use RTC timing by default, but if that fails, it prints a
warning and falls back to less accurate SDL timing.
</pre>

<h2><a id="contact">6. Contact Info</a></h2>

<h3>6.1. Contact Info</h3>

<h4>6.1.1. Contact Info</h4>

<p>
Since openMSX is still in heavy development, feedback and bug reports are very
welcome!
</p>

<p>
If you encounter problems, you have several options:
</p>

<ol>
<li>
If you're a regular user and want to discuss openMSX and possible problems,
join our <code>openmsx-user</code> mailing list.
More info on the
<a class="external" href="http://sourceforge.net/mail/?group_id=38274">openMSX mailing lists</a>,
including an archive of old messages, can be found at SourceForge.
</li>
<li>
Go to our IRC channel: <code>#openMSX</code> on <code>irc.freenode.net</code>
and ask your question there.
</li>
<li>
If you want to address the openMSX developers directly,
post a message to the <code>openmsx-devel</code> mailing list.
More info on the
<a class="external" href="http://sourceforge.net/mail/?group_id=38274">openMSX mailing lists</a>,
including an archive of old messages, can be found at SourceForge.
</li>
<li>
Use one of the
<a class="external" href="http://sourceforge.net/tracker/?group_id=38274">openMSX trackers</a>
at SourceForge.
At the moment of writing, there are four trackers:
Bugs, Support Requests, Patches and Feature Requests.
</li>
</ol>

<p>
For experienced users: if you get a crash,
try to provide a <code>gdb</code> backtrace.
This will only work if you did not strip the openMSX binary
of its debug symbols.
</p>

<p>
In any case, try to give as much information as possible when you describe your
bug or request.
</p>

<p class="version">
$Id$
</p>

</body>
</html>
