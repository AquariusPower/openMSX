# $Id$

from makeutils import filterFile, extractMakeVariables, parseBool

def extractVersion():
	makeVars = extractMakeVariables('build/version.mk')
	return makeVars['PACKAGE_VERSION'], parseBool(makeVars['RELEASE_FLAG'])

def extractChangeLogRevision():
	for revision, in filterFile('ChangeLog', r'\$Id: ChangeLog (\d+).*\$'):
		return revision
	else:
		raise ValueError('No "Id" keyword found in ChangeLog')

def iterVersionInclude():
	packageVersion, releaseFlag = extractVersion()
	changeLogRevision = extractChangeLogRevision()

	yield '// Automatically generated by build process.'
	yield ''
	yield 'const bool Version::RELEASE = %s;' % str(releaseFlag).lower()
	yield 'const std::string Version::VERSION = "%s";' % packageVersion
	yield 'const std::string Version::CHANGELOG_REVISION = "%s";' \
		% changeLogRevision

for line in iterVersionInclude():
	print line
