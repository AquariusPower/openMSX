# $Id$

from makeutils import filterFile, extractMakeVariables, parseBool

def extractChangeLogRevision():
	for revision, in filterFile('ChangeLog', r'\$Id: ChangeLog (\d+).*\$'):
		return revision
	else:
		raise ValueError('No "Id" keyword found in ChangeLog')

def iterVersionInclude():
	versionVars = extractMakeVariables('build/version.mk')
	packageVersion = versionVars['PACKAGE_VERSION']
	releaseFlag = parseBool(versionVars['RELEASE_FLAG'])

	changeLogRevision = extractChangeLogRevision()

	yield '// Automatically generated by build process.'
	yield ''
	yield 'const bool Version::RELEASE = %s;' % str(releaseFlag).lower()
	yield 'const std::string Version::VERSION = "%s";' % packageVersion
	yield 'const std::string Version::CHANGELOG_REVISION = "%s";' \
		% changeLogRevision

for line in iterVersionInclude():
	print line
